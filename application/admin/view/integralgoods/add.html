 {include file="public/header"}
 <style >
 .img_wrap #file_upload_img {position: absolute;opacity: 0;left: 0;top: 0;width: 100%;height: 100%;max-width: 100% !important;}
.img_wrap { overflow: hidden;height: 110px;width: 180px;position: relative;}
.img_wrap img { width: 100%;height: 100%;padding:5px;border: 1px dashed  #e2e2e2;}
.form-group-col-2 .form-cont{padding-left: 1px !important;}
.default{position: absolute;top: 80px;padding-left: 190px;}
.default img {width: 60px}
</style>
 <style >
 .content {padding-top: 30px !important;}
 .img_wrap #file_upload_img {position: absolute;opacity: 0;left: 0;top: 0;width: 100%;height: 100%;max-width: 100% !important;}
.img_wrap { overflow: hidden;height: 150px;width: 400px;position: relative;}
.img_wrap img { width: 100%;height: 100%;padding:5px;border: 1px dashed  #e2e2e2;}
.form-group-col-2 .form-cont{padding-left: 1px !important;}



 .img_wrap #file_list_img {position: absolute;opacity: 0;left: 0;top: 0;width: 100%;height: 100%;max-width: 100% !important;}
 .img_wrap { overflow: hidden;height: 110px;width: 180px;position: relative;}
 .img_wrap img { width: 100%;height: 100%;padding:5px;border: 1px dashed  #e2e2e2;}
 .form-group-col-2 .form-cont{padding-left: 1px !important;}
 .default{position: absolute;top: 80px;padding-left: 190px;}
 .default img {width: 60px}
 </style>
 <style >
	 .content {padding-top: 30px !important;}
	 .img_wrap #file_list_img {position: absolute;opacity: 0;left: 0;top: 0;width: 100%;height: 100%;max-width: 100% !important;}
	 .img_wrap { overflow: hidden;height: 150px;width: 400px;position: relative;}
	 .img_wrap img { width: 100%;height: 100%;padding:5px;border: 1px dashed  #e2e2e2;}
	 .form-group-col-2 .form-cont{padding-left: 1px !important;}


#comment {
	background-image: url(__STATIC__/images/icon/comment.svg);
    background-size: 20px 20px;
    background-position: 13px 13px;
    background-repeat: no-repeat;
}

input:hover, textarea:hover, input:focus, textarea:focus {
    background-color: white;
}
.feedback-input {
    color: #3c3c3c;
    font-family: Helvetica, Arial, sans-serif;
    font-weight: 500;
    font-size: 18px;
    border-radius: 0;
    line-height: 22px;
    background-color: #fbfbfb;
    padding: 13px 13px 13px 54px;
    margin-bottom: 10px;
    width: 100%;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    box-sizing: border-box;
    border: 3px solid rgba(0,0,0,0);
}
textarea {
    width: 100%;
    height: 150px;
    line-height: 150%;
    resize: vertical;
}
user agent stylesheet
textarea {
    font-family: monospace;
    border-color: rgb(169, 169, 169);
}
user agent stylesheet
textarea {
    -webkit-appearance: textarea;
    background-color: white;
    -webkit-rtl-ordering: logical;
    flex-direction: column;
    resize: auto;
    cursor: text;
    white-space: pre-wrap;
    word-wrap: break-word;
    border-width: 1px;
    border-style: solid;
    border-color: initial;
    border-image: initial;
    padding: 2px;
}
user agent stylesheet
input, textarea, select, button {
    text-rendering: auto;
    color: initial;
    letter-spacing: normal;
    word-spacing: normal;
    text-transform: none;
    text-indent: 0px;
    text-shadow: none;
    display: inline-block;
    text-align: start;
    margin: 0em;
    font: 400 13.3333px Arial;
}
user agent stylesheet
input, textarea, select, button, meter, progress {
    -webkit-writing-mode: horizontal-tb;
}
#pdf_queue{
	position: absolute;
    top: 0;
    width: 100%;
}
</style>
<link href="__STATIC__/admin/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
<link href="__STATIC__/plugins/wysiwyg/external/google-code-prettify/prettify.css" rel="stylesheet">
<link href="__STATIC__/plugins/twitter-bootstrap/bootstrap-combined.no-icons.min.css" rel="stylesheet">
<link href="__STATIC__/plugins/twitter-bootstrap/bootstrap-responsive.min.css" rel="stylesheet">
<link href="__STATIC__/admin/css/font-awesome.min.css?v=4.4.0" rel="stylesheet">
<link href="__STATIC__/plugins/wysiwyg/font-awesome.css" rel="stylesheet">
<!--
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet">
<link href="http://netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css" rel="stylesheet">
-->
<!--添加或者修改的弹框-->
    <div class="content">   
        <div class="weui_dialog_hd">
			<a href="javascript:window.history.go(-1);" class="icon icon-109 f-white" style="padding-right: 20px;color:#00A9E0 !important">返回</a>
            <span class="weui_dialog_title">添加产品</span>
        </div>
		
        <form id="myform" class="parsley-validate " onsubmit="return false" method="post" id="form" data-parsley-validate >  
			
			<div class="weui_cell" style="margin-top: 30px;">
				<div class="weui_cell_hd"><label for="" class="weui_label">类别:</label></div>
				<div class="weui_cell_bd weui_cell_primary">
					<select name="bu_id" required="required">
						{volist name="department" id="vo"  key="k"}
							<option value="{$vo.id}"{if condition="$vo.id eq input('param.bu_id')"} selected="selected" {/if} >{$vo.bu_name}</option>
						{/volist}
					</select>		
				</div>
			</div>
			<div class="weui_cell">
                <div class="weui_cell_hd"><label for="" class="weui_label">封面图:</label></div>
                <div class="weui_cell_bd weui_cell_primary">
					<div class="img_wrap">
						<img src="__STATIC__/images/icon/default_img.png" id="show_upload_img">
						<input type="file" id="file_upload_img">
					</div>	
					<div class="default" >
					</div>
					<p class="f-gray"><i class="icon icon-40 f20 "></i>JPG, PNG,GIF格式, 最大1M, 像素: 234X792px</p>
					<input type="text" name="cover" id="upload_img"  style="display: none" required="required"/>
                </div>	
            </div>

			<div class="weui_cell">
				<div class="weui_cell_hd"><label for="" class="weui_label">列表图片:</label></div>
				<div class="weui_cell_bd weui_cell_primary">
					<div class="img_wrap">
						<img src="__STATIC__/images/icon/default_img.png" id="show_list_img">
						<input type="file" id="file_list_img">
					</div>
					<div class="default" >
					</div>
					<p class="f-gray"><i class="icon icon-40 f20 "></i>JPG, PNG,GIF格式, 最大1M, 像素: 234X792px</p>
					<input type="text" name="list_img" id="list_img"  style="display: none" required="required"/>
				</div>
			</div>




            <div class="weui_cell">
                <div class="weui_cell_hd"><label for="" class="weui_label">产品名称 <span class="zn"></span>:</label></div>
                <div class="weui_cell_bd weui_cell_primary">
					
                    <input class="form-boxed form-control" type="text" name="name" value="" placeholder="名称"  data-parsley-trigger="change" required="required">
					<p class="f-gray"><i class="icon icon-40 f20 "></i> 字数在100字以内</p>
				</div>
            </div>

			<div class="weui_cell">
				<div class="weui_cell_hd"><label for="" class="weui_label">消费积分 <span class="zn"></span>:</label></div>
				<div class="weui_cell_bd weui_cell_primary">

					<input class="form-boxed form-control" type="number" name="integral" value="" placeholder="积分"  data-parsley-trigger="change" required="required">
					<p class="f-gray"><i class="icon icon-40 f20 "></i> 字数在100字以内</p>
				</div>
			</div>

			<div class="weui_cell">
				<div class="weui_cell_hd"><label for="" class="weui_label">数量 <span class="zn"></span>:</label></div>
				<div class="weui_cell_bd weui_cell_primary">

					<input class="form-boxed form-control" type="number" name="number" value="" placeholder="数量"  data-parsley-trigger="change" required="required">
					<p class="f-gray"><i class="icon icon-40 f20 "></i> 填写库存</p>
				</div>
			</div>

			<div class="weui_cell">
				<div class="weui_cell_hd"><label for="" class="weui_label">是否需要地址:</div>
				<div class="weui_cell_bd weui_cell_primary">
					<label class="radio-inline">
						<input type="radio" name="is_city" checked="checked" value="1"> 需要
					</label>
					<label class="radio-inline">
						<input type="radio" name="is_city" value="2"> 不需要
					</label>
				</div>
			</div>

			<div class="weui_cell">
				<div class="weui_cell_hd"><label for="" class="weui_label">商品详情 <span class="zn"></span>:</label></div>
				<div class="weui_cell_bd weui_cell_primary">

					<textarea name="description" style="width:700px;height:200px;visibility:hidden;"></textarea>
					<br />

				</div>
			</div>

            <div class="form-group-col-2">
                <div class="form-label"></div>
                <div class="form-cont">
                    <input type="submit" class="btn btn-primary" id="submit" value="submit" style="margin: 30px 0;margin-left: 1px;"/>
                </div>
            </div> 
        </form>
    </div>   

<script src="__STATIC__/js/zepto.min.js"></script>	
<script src="__STATIC__/plugins/wysiwyg/jquery.min.js"></script>
<script src="__STATIC__/plugins/wysiwyg/external/jquery.hotkeys.js"></script>
<script src="__STATIC__/plugins/twitter-bootstrap/js/bootstrap.min.js"></script>
<script src="__STATIC__/plugins/wysiwyg/external/google-code-prettify/prettify.js"></script>
<link href="__STATIC__/plugins/wysiwyg/index.css" rel="stylesheet">
<script src="__STATIC__/plugins/wysiwyg/bootstrap-wysiwyg.js"></script>	
<script src="__STATIC__/js/parsley.js"></script>
 <script charset="utf-8" src="__STATIC__/kindeditor/kindeditor-all-min.js"></script>

<script>

//表单验证成功后ajax提交保存
$('.parsley-validate').parsley().on('form:success', function() {
	document.getElementById("submit").disabled = false;
	ajax_saveData(); //提交数据
});
//加载编辑器
var editor;
// function bindData(data) {
var options = {
    cssPath : '__STATIC__/kindeditor/plugins/code/prettify.css',
    uploadJson: "{:url('Common/upload')}",
    fileManagerJson: '/Scripts/KindEditor/asp.net/file_manager_json.ashx',
    allowFileManager: true,
    afterBlur: function () {
        this.sync();
    },
    afterCreate: function () {
        this.sync();
    }
}
editor = KindEditor.create('textarea[name="description"]', options);
//ajax提交保存数据
var ajax_saveData = function(){
	$.ajax({
        cache: false,
        type: "POST",
        url:"{:url('add')}",
        data:$('#myform').serialize(),// 你的formid
        async: false,
        success: function(data) {
            if(data.code == 1 ){ //success
				window.location.href = "{:url('index',['type'=>'data','department_id'=>input('param.group_id')])}";
            } else {
               alert(data.msg);
            }
        }
    })
}
</script>


<script>
	//上传封面图片
    upload_img({
		url:'{:url("common/upload")}',
        file_name:'#file_upload_img',
        file_input_name:'#upload_img',
        show_upload_img:'#show_upload_img',
	});
    //上传列表图片
    upload_img({
        url:'{:url("common/upload")}',
        file_name:'#file_list_img',
        file_input_name:'#list_img',
        show_upload_img:'#show_list_img',
    });
    //上传图片加载方法
	function upload_img(opt){
        var options = {
            url: opt.url || '/admin/common/upload',
            file_name: opt.file_name || '#file_upload_img',// file对象
            file_input_name: opt.file_input_name || '#cover', //字段
            show_upload_img: opt.show_upload_img || '#show_upload_img', //显示图片对象
        };
        $(options.file_name).on('change',function(){
            var fd = new FormData();
            fd.append('file', $(options.file_name)[0].files[0]);
            $.ajax({
                url: options.url,
                type: "POST",
                processData: false,
                contentType: false,
                data: fd,
                success: function (result){
                    if(result){
                        $(options.file_input_name).val(result.url);
                        $(options.show_upload_img).attr("src",result.url);
                    }else{
                        alert('The system is busing please try again later, thanks!');
                    }
                }
            },'json');
        });
	}
 </script>

<script src="__STATIC__/js/uploadfile/jquery.uploadifive.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="__STATIC__/js/uploadfile/uploadifive.css"/>
	<script type="text/javascript">
	var file_upload = null;
		$(function() {
			$('#file_upload').uploadifive({
				'auto' : true,
				'uploadScript' : "{:url('Common/upload')}",
				'fileObjName' : "file",
				'buttonText' : '',
				'position' : 'absolute',
				'queueID' : 'queue',
				'fileType' : 'video/mp4',
				'multi' : false,
				'fileSizeLimit'   : 524288000,
				'uploadLimit' : 1,
				'queueSizeLimit'  : 1,   
				'onUploadComplete' : function(file, data) {
					var obj = JSON.parse(data);
					if (obj.img == "500") {
						alert("System 500 error！");
					} else {
						file_upload =1;
						$("#file_url").val(obj.url);
						document.getElementById("submit").disabled = false;
					}
				},
				onCancel : function(file) {
				   $("#file_url").val("");
				   file_upload = null;
					/* 注意：取消后应重新设置uploadLimit */
					$data    = $(this).data('uploadifive'),
					settings = $data.settings;
					settings.uploadLimit++;
					//alert(file.name + " 已取消上传~!");
				},
				onFallback : function() {
					alert("The browser cannot be used!");
				},
				onUpload : function(file) {
					document.getElementById("submit").disabled = true;//当开始上传文件，要防止上传未完成而表单被提交
				},
			});
		});
	</script>
	
	
	
	<script type="text/javascript">
	var file_upload = null;
		$(function() {
			$('#pdf_file_upload').uploadifive({
				'auto' : true,
				'uploadScript' : "{:url('Common/upload')}",
				'fileObjName' : "file",
				'buttonText' : '',
				'position' : 'absolute',
				'queueID' : 'pdf_queue',
				'fileType' : '*',
				'multi' : false,
				'fileSizeLimit'   : 524288000,
				'uploadLimit' : 1,
				'queueSizeLimit'  : 1,   
				'onUploadComplete' : function(file, data) {
					var obj = JSON.parse(data);
					if (obj.img == "500") {
						alert("System 500 error！");
					} else {
						file_upload =1;
						$("#pdf_file_url").val(obj.url);
						document.getElementById("submit").disabled = false;
					}
				},
				onCancel : function(file) {
				   $("#pdf_file_url").val("");
				   file_upload = null;
					/* 注意：取消后应重新设置uploadLimit */
					$data    = $(this).data('uploadifive'),
					settings = $data.settings;
					settings.uploadLimit++;
					//alert(file.name + " 已取消上传~!");
				},
				onFallback : function() {
					alert("The browser cannot be used!");
				},
				onUpload : function(file) {
					document.getElementById("submit").disabled = true;//当开始上传文件，要防止上传未完成而表单被提交
				},
			});
		});
	</script>
	
	
	
	
	
	
	
	
<script>
var upload_url = "{:url('Common/saveBase64Image')}"; //必须定义上传图片的地址
$(function () {
        function initToolbarBootstrapBindings() {
            var fonts = ['Serif', 'Sans', 'Arial', 'Arial Black', 'Courier',
                        'Courier New', 'Comic Sans MS', 'Helvetica', 'Impact', 'Lucida Grande', 'Lucida Sans', 'Tahoma', 'Times',
                        'Times New Roman', 'Verdana'],
                    fontTarget = $('[title=Font]').siblings('.dropdown-menu');
            $.each(fonts, function (idx, fontName) {
                fontTarget.append($('<li><a data-edit="fontName ' + fontName + '" style="font-family:\'' + fontName + '\'">' + fontName + '</a></li>'));
            });
            $('a[title]').tooltip({container: 'body'});
            $('.dropdown-menu input').click(function () {
                return false;
            }).change(function () {
                $(this).parent('.dropdown-menu').siblings('.dropdown-toggle').dropdown('toggle');
            }).keydown('esc', function () {
                this.value = '';
                $(this).change();
            });

            $('[data-role=magic-overlay]').each(function () {
                var overlay = $(this), target = $(overlay.data('target'));
                overlay.css('opacity', 0).css('position', 'absolute').offset(target.offset()).width(target.outerWidth()).height(target.outerHeight());
            });
            $('#voiceBtn').hide();
        };
        initToolbarBootstrapBindings();
        $('#editor').wysiwyg();
        window.prettyPrint && prettyPrint();
    });
</script>


<style type="text/css">
body {font: 13px Arial, Helvetica, Sans-serif;}
.uploadifive-button {float: left;margin-right: 10px;}
#queue {position: absolute;top: 0; width: 100%;}
.layui-upload-drag {position: relative; border: 1px dashed #e2e2e2;background-color: #fff;text-align: center; cursor: pointer;color: #999;}
.layui-upload-drag input{height:100%;width:100%}
.layui-upload-drag i{font-size: 35px;color: #009688;}
.layui-icon { font-size: 50px;color: #009688;}
.layui-icon {font-family: layui-icon!important;font-size: 16px;font-style: normal;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;
}.uploadifive-queue-item{height:100%;}
.uploadifive-button{opacity: 0;position: absolute;top: 0;height: 100%;} 
</style>






